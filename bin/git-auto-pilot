#!/bin/bash

_git_commit_all_last=$(perl -e 'print time')
_git_commit_all() {
    __now=$(perl -e 'print time')
    if (( $(($__now - $_git_commit_all_last)) > 30 )); then
        git commit -a --allow-empty-message --no-edit --author 'Auto Pilot <noreply@localhost>'
        _git_commit_all_last=$(perl -e 'print time')
    fi
}

if [[ "$1" != "" ]]; then
    cd $1
fi

while inotifywait -q -e close -r --format '%f' . ; do
    _git_commit_all
done

